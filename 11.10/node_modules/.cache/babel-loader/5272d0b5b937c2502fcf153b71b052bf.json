{"ast":null,"code":"import { append, addClass, remove, isNullOrUndefined, setStyleAttribute, createElement } from '@syncfusion/ej2-base';\nimport { isBlazor } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\nimport * as util from '../base/util';\n/**\n * Virtual Scroll\n */\n\nvar VirtualScroll =\n/** @class */\nfunction () {\n  function VirtualScroll(parent) {\n    this.translateY = 0;\n    this.itemSize = 60;\n    this.bufferCount = 3;\n    this.renderedLength = 0;\n    this.averageRowHeight = 0;\n    this.startIndex = 0;\n    this.isScrollHeightNull = true;\n    this.previousTop = 0;\n    this.parent = parent;\n    this.addEventListener();\n  }\n\n  VirtualScroll.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.virtualScroll, this.virtualScrolling, this);\n  };\n\n  VirtualScroll.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.virtualScroll, this.virtualScrolling);\n  };\n\n  VirtualScroll.prototype.getRenderedCount = function () {\n    if (isBlazor()) {\n      var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n      this.renderedLength = conTable.querySelector('tbody').children.length;\n      return this.renderedLength;\n    }\n\n    this.setItemSize();\n    return Math.ceil(this.parent.element.clientHeight / this.itemSize) + this.bufferCount;\n  };\n\n  VirtualScroll.prototype.triggerScrolling = function () {\n    this.parent.showSpinner(); // tslint:disable-next-line:no-any\n\n    var scheduleObj = this.parent;\n    var adaptor = 'interopAdaptor';\n    var invokeMethodAsync = 'invokeMethodAsync';\n    scheduleObj[adaptor][invokeMethodAsync]('OnContentUpdate', this.startIndex);\n  };\n\n  VirtualScroll.prototype.setTranslateValue = function () {\n    var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n    var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n    var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n    this.renderVirtualTrackHeight(conWrap, resWrap);\n    this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n  };\n\n  VirtualScroll.prototype.renderVirtualTrackHeight = function (contentWrap, resourceWrap) {\n    this.parent.resourceBase.setExpandedResources();\n\n    if (this.isScrollHeightNull) {\n      var wrap = createElement('div', {\n        className: cls.VIRTUAL_TRACK_CLASS\n      });\n      var resWrap = [].slice.call(resourceWrap.querySelectorAll('table td'));\n      var startIndex_1 = parseInt(resWrap[0].getAttribute('data-group-index'), 10);\n      var endIndex_1 = parseInt(resWrap[resWrap.length - 1].getAttribute('data-group-index'), 10);\n      this.parent.resourceBase.renderedResources = this.parent.resourceBase.expandedResources.filter(function (resource) {\n        return resource.groupIndex >= startIndex_1 && resource.groupIndex <= endIndex_1;\n      });\n      this.setItemSize();\n      wrap.style.height = this.parent.resourceBase.expandedResources.length * this.itemSize + 'px';\n      this.isScrollHeightNull = false;\n      var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n\n      if (!isNullOrUndefined(virtual)) {\n        remove(virtual);\n      }\n\n      contentWrap.appendChild(wrap);\n    }\n  };\n\n  VirtualScroll.prototype.renderVirtualTrack = function (contentWrap) {\n    var wrap = createElement('div', {\n      className: cls.VIRTUAL_TRACK_CLASS\n    });\n    wrap.style.height = this.parent.resourceBase.expandedResources.length * this.itemSize + 'px';\n    contentWrap.appendChild(wrap);\n  };\n\n  VirtualScroll.prototype.updateVirtualScrollHeight = function () {\n    var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n    var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n    var lastRenderIndex = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n\n    if (lastRenderIndex !== lastResourceIndex || isBlazor()) {\n      var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n      this.renderedLength = conTable.querySelector('tbody').children.length;\n      virtual.style.height = conTable.offsetHeight + (this.parent.resourceBase.expandedResources.length - this.renderedLength) * conTable.offsetHeight / this.renderedLength + 'px';\n    } else {\n      virtual.style.height = '';\n    }\n\n    this.averageRowHeight = virtual.offsetHeight / this.parent.resourceBase.expandedResources.length;\n  };\n\n  VirtualScroll.prototype.updateVirtualTrackHeight = function (wrap) {\n    var resourceCount = this.parent.resourceBase.renderedResources.length;\n\n    if (resourceCount !== this.getRenderedCount()) {\n      wrap.style.height = this.parent.element.querySelector('.e-content-wrap').clientHeight + 'px';\n      var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n      var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n      var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n      this.translateY = 0;\n      this.setTranslate(resWrap, conWrap, eventWrap);\n    } else {\n      var lastRenderIndex = this.parent.resourceBase.renderedResources[resourceCount - 1].groupIndex;\n      var lastCollIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n      var renderedResConut = resourceCount + (lastCollIndex - lastRenderIndex);\n      renderedResConut = renderedResConut > this.parent.resourceBase.expandedResources.length ? this.parent.resourceBase.expandedResources.length : renderedResConut;\n      wrap.style.height = renderedResConut * this.itemSize + 'px';\n    }\n  };\n\n  VirtualScroll.prototype.setItemSize = function () {\n    this.itemSize = util.getElementHeightFromClass(this.parent.activeView.element, cls.WORK_CELLS_CLASS) || this.itemSize;\n  };\n\n  VirtualScroll.prototype.beforeInvoke = function (resWrap, conWrap, eventWrap, timeIndicator) {\n    var _this = this;\n\n    if (isBlazor()) {\n      window.clearTimeout(this.timeValue);\n      this.timeValue = window.setTimeout(function () {\n        _this.triggerScrolling();\n      }, 250);\n      this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n      this.previousTop = conWrap.scrollTop;\n    }\n  };\n\n  VirtualScroll.prototype.virtualScrolling = function () {\n    var _this = this;\n\n    this.parent.quickPopup.quickPopupHide();\n    this.parent.quickPopup.morePopup.hide();\n    var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n    var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n    var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n    var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n    this.renderedLength = resWrap.querySelector('tbody').children.length;\n    var firstTDIndex = parseInt(resWrap.querySelector('tbody td').getAttribute('data-group-index'), 10);\n    var scrollHeight = this.parent.rowAutoHeight ? conTable.offsetHeight - conWrap.offsetHeight : this.bufferCount * this.itemSize;\n    addClass([conWrap], 'e-transition');\n\n    if (isBlazor()) {\n      this.setItemSize();\n    }\n\n    var resCollection = [];\n\n    if (conWrap.scrollTop - this.translateY < 0) {\n      resCollection = this.upScroll(conWrap, firstTDIndex);\n      this.beforeInvoke(resWrap, conWrap, eventWrap, timeIndicator);\n    } else if (conWrap.scrollTop - this.translateY > scrollHeight) {\n      resCollection = this.downScroll(conWrap, firstTDIndex);\n\n      if (!(this.previousTop === conWrap.scrollTop)) {\n        this.beforeInvoke(resWrap, conWrap, eventWrap, timeIndicator);\n      }\n    }\n\n    if (!isBlazor()) {\n      if (!isNullOrUndefined(resCollection) && resCollection.length > 0) {\n        this.parent.showSpinner();\n        this.updateContent(resWrap, conWrap, eventWrap, resCollection);\n        this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n        this.parent.notify(events.dataReady, {});\n\n        if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj.action === 'drag') {\n          this.parent.dragAndDropModule.navigationWrapper();\n        }\n\n        window.clearTimeout(this.timeValue);\n        this.timeValue = window.setTimeout(function () {\n          _this.parent.hideSpinner();\n        }, 250);\n      }\n    }\n  };\n\n  VirtualScroll.prototype.upScroll = function (conWrap, firstTDIndex) {\n    var index = 0;\n\n    if (isBlazor()) {\n      index = ~~(conWrap.scrollTop / this.itemSize);\n    } else {\n      index = ~~(conWrap.scrollTop / this.itemSize) + Math.ceil(conWrap.clientHeight / this.itemSize) - this.renderedLength;\n    }\n\n    if (this.parent.rowAutoHeight) {\n      index = index > firstTDIndex ? firstTDIndex - this.bufferCount : index;\n    }\n\n    index = index > 0 ? index : 0;\n    var prevSetCollection = this.getBufferCollection(index, index + this.renderedLength);\n    this.parent.resourceBase.renderedResources = prevSetCollection;\n\n    if (firstTDIndex === 0) {\n      this.translateY = conWrap.scrollTop;\n    } else {\n      var height = this.parent.rowAutoHeight ? this.averageRowHeight : this.itemSize;\n      this.translateY = conWrap.scrollTop - this.bufferCount * height > 0 ? conWrap.scrollTop - this.bufferCount * height : 0;\n    }\n\n    if (isBlazor()) {\n      this.startIndex = index;\n    }\n\n    return prevSetCollection;\n  };\n\n  VirtualScroll.prototype.downScroll = function (conWrap, firstTDIndex) {\n    var lastResource = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n    var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n\n    if (lastResource === lastResourceIndex) {\n      return null;\n    }\n\n    var nextSetResIndex = 0;\n    var height = this.parent.rowAutoHeight ? this.averageRowHeight : this.itemSize;\n\n    if (isBlazor()) {\n      nextSetResIndex = ~~(conWrap.scrollTop / height);\n    } else {\n      nextSetResIndex = ~~(conWrap.scrollTop / this.itemSize);\n\n      if (this.parent.rowAutoHeight) {\n        nextSetResIndex = ~~((conWrap.scrollTop - this.translateY) / this.averageRowHeight) + firstTDIndex;\n        nextSetResIndex = nextSetResIndex > firstTDIndex + this.bufferCount ? nextSetResIndex : firstTDIndex + this.bufferCount;\n      }\n    }\n\n    var lastIndex = nextSetResIndex + this.renderedLength;\n    lastIndex = lastIndex > this.parent.resourceBase.expandedResources.length ? nextSetResIndex + (this.parent.resourceBase.expandedResources.length - nextSetResIndex) : lastIndex;\n    var nextSetCollection = this.getBufferCollection(lastIndex - this.renderedLength, lastIndex);\n    this.translateY = conWrap.scrollTop;\n\n    if (isBlazor()) {\n      if (this.translateY > this.parent.resourceBase.expandedResources.length * height - this.renderedLength * height) {\n        this.translateY = this.parent.resourceBase.expandedResources.length * height - this.renderedLength * height;\n      }\n\n      this.startIndex = lastIndex - this.renderedLength;\n      this.parent.resourceBase.renderedResources = nextSetCollection;\n    }\n\n    return nextSetCollection;\n  };\n\n  VirtualScroll.prototype.updateContent = function (resWrap, conWrap, eventWrap, resCollection) {\n    var renderedLenth = resWrap.querySelector('tbody').children.length;\n\n    for (var i = 0; i < renderedLenth; i++) {\n      remove(resWrap.querySelector('tbody tr'));\n      remove(conWrap.querySelector('tbody tr'));\n      remove(eventWrap.querySelector('div'));\n    }\n\n    this.parent.resourceBase.renderedResources = resCollection;\n    var resourceRows = this.parent.resourceBase.getContentRows(resCollection);\n    var contentRows = this.parent.activeView.getContentRows();\n    var eventRows = this.parent.activeView.getEventRows(resCollection.length);\n    append(resourceRows, resWrap.querySelector('tbody'));\n    append(contentRows, conWrap.querySelector('tbody'));\n    append(eventRows, eventWrap);\n  };\n\n  VirtualScroll.prototype.getBufferCollection = function (startIndex, endIndex) {\n    return this.parent.resourceBase.expandedResources.slice(startIndex, endIndex);\n  };\n\n  VirtualScroll.prototype.setTranslate = function (resWrap, conWrap, eventWrap, timeIndicator) {\n    setStyleAttribute(resWrap.querySelector('table'), {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n    setStyleAttribute(conWrap.querySelector('table'), {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n    setStyleAttribute(eventWrap, {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n\n    if (!isNullOrUndefined(timeIndicator)) {\n      setStyleAttribute(timeIndicator, {\n        transform: \"translateY(\" + this.translateY + \"px)\"\n      });\n    }\n  };\n\n  VirtualScroll.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  return VirtualScroll;\n}();\n\nexport { VirtualScroll };","map":{"version":3,"sources":["/Users/evanschubert/Documents/Coding/git/CMPS285-Fall2020-Section1-Group-6/11.5/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/virtual-scroll.js"],"names":["append","addClass","remove","isNullOrUndefined","setStyleAttribute","createElement","isBlazor","events","cls","util","VirtualScroll","parent","translateY","itemSize","bufferCount","renderedLength","averageRowHeight","startIndex","isScrollHeightNull","previousTop","addEventListener","prototype","isDestroyed","on","virtualScroll","virtualScrolling","removeEventListener","off","getRenderedCount","conTable","element","querySelector","CONTENT_TABLE_CLASS","children","length","setItemSize","Math","ceil","clientHeight","triggerScrolling","showSpinner","scheduleObj","adaptor","invokeMethodAsync","setTranslateValue","resWrap","RESOURCE_COLUMN_WRAP_CLASS","conWrap","CONTENT_WRAP_CLASS","eventWrap","EVENT_TABLE_CLASS","timeIndicator","CURRENT_TIMELINE_CLASS","renderVirtualTrackHeight","setTranslate","contentWrap","resourceWrap","resourceBase","setExpandedResources","wrap","className","VIRTUAL_TRACK_CLASS","slice","call","querySelectorAll","startIndex_1","parseInt","getAttribute","endIndex_1","renderedResources","expandedResources","filter","resource","groupIndex","style","height","virtual","appendChild","renderVirtualTrack","updateVirtualScrollHeight","lastResourceIndex","lastRenderIndex","offsetHeight","updateVirtualTrackHeight","resourceCount","lastCollIndex","renderedResConut","getElementHeightFromClass","activeView","WORK_CELLS_CLASS","beforeInvoke","_this","window","clearTimeout","timeValue","setTimeout","scrollTop","quickPopup","quickPopupHide","morePopup","hide","firstTDIndex","scrollHeight","rowAutoHeight","resCollection","upScroll","downScroll","updateContent","notify","dataReady","dragAndDropModule","actionObj","action","navigationWrapper","hideSpinner","index","prevSetCollection","getBufferCollection","lastResource","nextSetResIndex","lastIndex","nextSetCollection","renderedLenth","i","resourceRows","getContentRows","contentRows","eventRows","getEventRows","endIndex","transform","destroy"],"mappings":"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","sourcesContent":["import { append, addClass, remove, isNullOrUndefined, setStyleAttribute, createElement } from '@syncfusion/ej2-base';\nimport { isBlazor } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\nimport * as util from '../base/util';\n/**\n * Virtual Scroll\n */\nvar VirtualScroll = /** @class */ (function () {\n    function VirtualScroll(parent) {\n        this.translateY = 0;\n        this.itemSize = 60;\n        this.bufferCount = 3;\n        this.renderedLength = 0;\n        this.averageRowHeight = 0;\n        this.startIndex = 0;\n        this.isScrollHeightNull = true;\n        this.previousTop = 0;\n        this.parent = parent;\n        this.addEventListener();\n    }\n    VirtualScroll.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.virtualScroll, this.virtualScrolling, this);\n    };\n    VirtualScroll.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.virtualScroll, this.virtualScrolling);\n    };\n    VirtualScroll.prototype.getRenderedCount = function () {\n        if (isBlazor()) {\n            var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n            this.renderedLength = conTable.querySelector('tbody').children.length;\n            return this.renderedLength;\n        }\n        this.setItemSize();\n        return Math.ceil(this.parent.element.clientHeight / this.itemSize) + this.bufferCount;\n    };\n    VirtualScroll.prototype.triggerScrolling = function () {\n        this.parent.showSpinner();\n        // tslint:disable-next-line:no-any\n        var scheduleObj = this.parent;\n        var adaptor = 'interopAdaptor';\n        var invokeMethodAsync = 'invokeMethodAsync';\n        scheduleObj[adaptor][invokeMethodAsync]('OnContentUpdate', this.startIndex);\n    };\n    VirtualScroll.prototype.setTranslateValue = function () {\n        var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n        var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n        var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n        this.renderVirtualTrackHeight(conWrap, resWrap);\n        this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n    };\n    VirtualScroll.prototype.renderVirtualTrackHeight = function (contentWrap, resourceWrap) {\n        this.parent.resourceBase.setExpandedResources();\n        if (this.isScrollHeightNull) {\n            var wrap = createElement('div', { className: cls.VIRTUAL_TRACK_CLASS });\n            var resWrap = [].slice.call((resourceWrap).querySelectorAll('table td'));\n            var startIndex_1 = parseInt(resWrap[0].getAttribute('data-group-index'), 10);\n            var endIndex_1 = parseInt(resWrap[resWrap.length - 1].getAttribute('data-group-index'), 10);\n            this.parent.resourceBase.renderedResources = this.parent.resourceBase.expandedResources.filter(function (resource) {\n                return (resource.groupIndex >= startIndex_1 && resource.groupIndex <= endIndex_1);\n            });\n            this.setItemSize();\n            wrap.style.height = (this.parent.resourceBase.expandedResources.length * this.itemSize) + 'px';\n            this.isScrollHeightNull = false;\n            var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n            if (!isNullOrUndefined(virtual)) {\n                remove(virtual);\n            }\n            contentWrap.appendChild(wrap);\n        }\n    };\n    VirtualScroll.prototype.renderVirtualTrack = function (contentWrap) {\n        var wrap = createElement('div', { className: cls.VIRTUAL_TRACK_CLASS });\n        wrap.style.height = (this.parent.resourceBase.expandedResources.length * this.itemSize) + 'px';\n        contentWrap.appendChild(wrap);\n    };\n    VirtualScroll.prototype.updateVirtualScrollHeight = function () {\n        var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n        var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n        var lastRenderIndex = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n        if (lastRenderIndex !== lastResourceIndex || isBlazor()) {\n            var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n            this.renderedLength = conTable.querySelector('tbody').children.length;\n            virtual.style.height = (conTable.offsetHeight + (this.parent.resourceBase.expandedResources.length - (this.renderedLength)) *\n                conTable.offsetHeight / this.renderedLength) + 'px';\n        }\n        else {\n            virtual.style.height = '';\n        }\n        this.averageRowHeight = virtual.offsetHeight / this.parent.resourceBase.expandedResources.length;\n    };\n    VirtualScroll.prototype.updateVirtualTrackHeight = function (wrap) {\n        var resourceCount = this.parent.resourceBase.renderedResources.length;\n        if (resourceCount !== this.getRenderedCount()) {\n            wrap.style.height = this.parent.element.querySelector('.e-content-wrap').clientHeight + 'px';\n            var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n            var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n            var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n            this.translateY = 0;\n            this.setTranslate(resWrap, conWrap, eventWrap);\n        }\n        else {\n            var lastRenderIndex = this.parent.resourceBase.renderedResources[resourceCount - 1].groupIndex;\n            var lastCollIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n            var renderedResConut = resourceCount + (lastCollIndex - lastRenderIndex);\n            renderedResConut = (renderedResConut > this.parent.resourceBase.expandedResources.length) ?\n                this.parent.resourceBase.expandedResources.length : renderedResConut;\n            wrap.style.height = (renderedResConut * this.itemSize) + 'px';\n        }\n    };\n    VirtualScroll.prototype.setItemSize = function () {\n        this.itemSize = util.getElementHeightFromClass(this.parent.activeView.element, cls.WORK_CELLS_CLASS) || this.itemSize;\n    };\n    VirtualScroll.prototype.beforeInvoke = function (resWrap, conWrap, eventWrap, timeIndicator) {\n        var _this = this;\n        if (isBlazor()) {\n            window.clearTimeout(this.timeValue);\n            this.timeValue = window.setTimeout(function () { _this.triggerScrolling(); }, 250);\n            this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n            this.previousTop = conWrap.scrollTop;\n        }\n    };\n    VirtualScroll.prototype.virtualScrolling = function () {\n        var _this = this;\n        this.parent.quickPopup.quickPopupHide();\n        this.parent.quickPopup.morePopup.hide();\n        var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n        var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n        var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n        var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n        this.renderedLength = resWrap.querySelector('tbody').children.length;\n        var firstTDIndex = parseInt(resWrap.querySelector('tbody td').getAttribute('data-group-index'), 10);\n        var scrollHeight = this.parent.rowAutoHeight ?\n            (conTable.offsetHeight - conWrap.offsetHeight) : this.bufferCount * this.itemSize;\n        addClass([conWrap], 'e-transition');\n        if (isBlazor()) {\n            this.setItemSize();\n        }\n        var resCollection = [];\n        if ((conWrap.scrollTop) - this.translateY < 0) {\n            resCollection = this.upScroll(conWrap, firstTDIndex);\n            this.beforeInvoke(resWrap, conWrap, eventWrap, timeIndicator);\n        }\n        else if (conWrap.scrollTop - this.translateY > scrollHeight) {\n            resCollection = this.downScroll(conWrap, firstTDIndex);\n            if (!(this.previousTop === conWrap.scrollTop)) {\n                this.beforeInvoke(resWrap, conWrap, eventWrap, timeIndicator);\n            }\n        }\n        if (!isBlazor()) {\n            if (!isNullOrUndefined(resCollection) && resCollection.length > 0) {\n                this.parent.showSpinner();\n                this.updateContent(resWrap, conWrap, eventWrap, resCollection);\n                this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n                this.parent.notify(events.dataReady, {});\n                if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj.action === 'drag') {\n                    this.parent.dragAndDropModule.navigationWrapper();\n                }\n                window.clearTimeout(this.timeValue);\n                this.timeValue = window.setTimeout(function () { _this.parent.hideSpinner(); }, 250);\n            }\n        }\n    };\n    VirtualScroll.prototype.upScroll = function (conWrap, firstTDIndex) {\n        var index = 0;\n        if (isBlazor()) {\n            index = ~~(conWrap.scrollTop / this.itemSize);\n        }\n        else {\n            index = (~~(conWrap.scrollTop / this.itemSize) + Math.ceil(conWrap.clientHeight / this.itemSize)) - this.renderedLength;\n        }\n        if (this.parent.rowAutoHeight) {\n            index = (index > firstTDIndex) ? firstTDIndex - this.bufferCount : index;\n        }\n        index = (index > 0) ? index : 0;\n        var prevSetCollection = this.getBufferCollection(index, index + this.renderedLength);\n        this.parent.resourceBase.renderedResources = prevSetCollection;\n        if (firstTDIndex === 0) {\n            this.translateY = conWrap.scrollTop;\n        }\n        else {\n            var height = (this.parent.rowAutoHeight) ? this.averageRowHeight : this.itemSize;\n            this.translateY = (conWrap.scrollTop - (this.bufferCount * height) > 0) ?\n                conWrap.scrollTop - (this.bufferCount * height) : 0;\n        }\n        if (isBlazor()) {\n            this.startIndex = index;\n        }\n        return prevSetCollection;\n    };\n    VirtualScroll.prototype.downScroll = function (conWrap, firstTDIndex) {\n        var lastResource = this.parent.resourceBase.\n            renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n        var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n        if (lastResource === lastResourceIndex) {\n            return null;\n        }\n        var nextSetResIndex = 0;\n        var height = (this.parent.rowAutoHeight) ? this.averageRowHeight : this.itemSize;\n        if (isBlazor()) {\n            nextSetResIndex = ~~(conWrap.scrollTop / height);\n        }\n        else {\n            nextSetResIndex = ~~(conWrap.scrollTop / this.itemSize);\n            if (this.parent.rowAutoHeight) {\n                nextSetResIndex = ~~((conWrap.scrollTop - this.translateY) / this.averageRowHeight) + firstTDIndex;\n                nextSetResIndex = (nextSetResIndex > firstTDIndex + this.bufferCount) ? nextSetResIndex : firstTDIndex + this.bufferCount;\n            }\n        }\n        var lastIndex = nextSetResIndex + this.renderedLength;\n        lastIndex = (lastIndex > this.parent.resourceBase.expandedResources.length) ?\n            nextSetResIndex + (this.parent.resourceBase.expandedResources.length - nextSetResIndex) : lastIndex;\n        var nextSetCollection = this.getBufferCollection(lastIndex - this.renderedLength, lastIndex);\n        this.translateY = conWrap.scrollTop;\n        if (isBlazor()) {\n            if (this.translateY > (this.parent.resourceBase.expandedResources.length * height) - (this.renderedLength * height)) {\n                this.translateY = (this.parent.resourceBase.expandedResources.length * height) - (this.renderedLength * height);\n            }\n            this.startIndex = lastIndex - this.renderedLength;\n            this.parent.resourceBase.renderedResources = nextSetCollection;\n        }\n        return nextSetCollection;\n    };\n    VirtualScroll.prototype.updateContent = function (resWrap, conWrap, eventWrap, resCollection) {\n        var renderedLenth = resWrap.querySelector('tbody').children.length;\n        for (var i = 0; i < renderedLenth; i++) {\n            remove(resWrap.querySelector('tbody tr'));\n            remove(conWrap.querySelector('tbody tr'));\n            remove(eventWrap.querySelector('div'));\n        }\n        this.parent.resourceBase.renderedResources = resCollection;\n        var resourceRows = this.parent.resourceBase.getContentRows(resCollection);\n        var contentRows = this.parent.activeView.getContentRows();\n        var eventRows = this.parent.activeView.getEventRows(resCollection.length);\n        append(resourceRows, resWrap.querySelector('tbody'));\n        append(contentRows, conWrap.querySelector('tbody'));\n        append(eventRows, eventWrap);\n    };\n    VirtualScroll.prototype.getBufferCollection = function (startIndex, endIndex) {\n        return this.parent.resourceBase.expandedResources.slice(startIndex, endIndex);\n    };\n    VirtualScroll.prototype.setTranslate = function (resWrap, conWrap, eventWrap, timeIndicator) {\n        setStyleAttribute(resWrap.querySelector('table'), {\n            transform: \"translateY(\" + this.translateY + \"px)\"\n        });\n        setStyleAttribute(conWrap.querySelector('table'), {\n            transform: \"translateY(\" + this.translateY + \"px)\"\n        });\n        setStyleAttribute(eventWrap, {\n            transform: \"translateY(\" + this.translateY + \"px)\"\n        });\n        if (!isNullOrUndefined(timeIndicator)) {\n            setStyleAttribute(timeIndicator, {\n                transform: \"translateY(\" + this.translateY + \"px)\"\n            });\n        }\n    };\n    VirtualScroll.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    return VirtualScroll;\n}());\nexport { VirtualScroll };\n"]},"metadata":{},"sourceType":"module"}